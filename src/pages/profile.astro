---
import Layout from "../layouts/Layout.astro";

const authCookie = Astro.cookies.get("pb_auth");
let isConnected = false;
let userData = null;

if (authCookie) {
  try {
    const authData = JSON.parse(decodeURIComponent(authCookie.value));
    userData = authData.model;
    isConnected = true;
  } catch (e) {
    // Cookie invalide
  }
} else {
  return Astro.redirect("/connexion");
}
---

<Layout title="Profil - TaVue">
  <div class="container mx-auto px-4 py-8 max-w-2xl">
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-3xl font-bold mb-6">Mon Profil</h2>

        <div class="space-y-4">
          <div class="flex items-center gap-4 p-4 bg-base-200 rounded-lg">
            <div class="avatar placeholder">
              <div class="bg-neutral text-neutral-content rounded-full w-16">
                <span class="text-2xl"
                  >{userData?.prenom?.[0]}{userData?.nom?.[0]}</span
                >
              </div>
            </div>
            <div>
              <h3 class="text-xl font-bold">
                {userData?.prenom}
                {userData?.nom}
              </h3>
              <p class="text-sm opacity-70">{userData?.email}</p>
            </div>
          </div>

          <div class="divider"></div>

          <div class="grid gap-3">
            <a href="/configurateur" class="btn btn-primary">
              Configurer mes lunettes
            </a>

            <a href="/mes-lunettes" class="btn btn-outline"> Mes lunettes </a>
          </div>

          <div class="divider"></div>

          <button id="logout-btn" class="btn btn-error btn-outline w-full">
            DÃ©connexion
          </button>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  document.getElementById("logout-btn")!.addEventListener("click", () => {
    document.cookie = "pb_auth=; path=/; max-age=0";
    window.location.href = "/connexion";
  });
</script>
